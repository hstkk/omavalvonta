@(results: models.dynamicforms.Results)

@import tags._
@import tags.alerts._
@import tags.tables._
@import play.i18n._
@import utils.Converter

@main(Messages.get("history.title", results.getOldForm.toString)) {
	@tabs(results)

	@info() { @Messages.get("history.info") }

	@if(results.results != null || results.results.isEmpty) {
		@for(result <- results.results) {
			@history(result)
		}
	} else {
		@warning() {
			@Messages.get("history.empty")
		}
	}
}

@subTitle(field: models.dynamicforms.Field) = {
	@if(!results.isFieldsetPrinted(field.fieldset.id)) {
		<h2>@field.fieldset</h2>
	}
}

@history(result: models.dynamicforms.Result) = {
	@defining(results.getOldField(result)) { field =>
		@subTitle(field)
		<h3>@field.name</h3>
		<p>@field.fieldset</p>
	}
	@table() {
		@thead() {
			@Messages.get("history.updated")
			@Messages.get("results.result")
			@Messages.get("label.user")
			@Messages.get("label.comment")
			@Messages.get("enum.REASON")
		}
		<tbody>
			@defining(models.dynamicforms.Result.dao.getVersions(result.id)) { oldResults =>
				@if(oldResults != null) {
					@for(oldResult <- oldResults) {
						@if(oldResult != null && oldResult.lastModified != null) {
							<tr>
								<td>@Converter.dateToString(oldResult.lastModified)</td>
								<td>@oldResult</td>
								<td>@if(oldResult.user != null) { @oldResult.user }</td>
								<td>@if(oldResult.comment != null) { @oldResult.comment }</td>
								<td>@if(oldResult.reason != null) { @oldResult.reason }</td>
							</tr>
						}
					}
				}
			}
		</tbody>
	}
}