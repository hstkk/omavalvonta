@(FORM: play.data.Form[models.dynamicforms.Results], results: models.dynamicforms.Results)

@import play.i18n._
@import helper._
@import controllers.shib.Session

@forms.form(results.getOldForm)

@defining(Session.username != null) { isLogged =>
	@defining(options(models.Term.options(models.TermCategory.REASON))) { _options =>
		@repeat(FORM("results")) { result =>
			@FIELDSET(result)
			@FIELD(result, isLogged, _options)
		}
	}
}

@FIELDSET(field: Field) = {
	@defining(field("field.fieldset.id").value.getOrElse("")) { fieldsetId =>
		@if(!fieldsetId.isEmpty && results.isFieldsetPrinted(fieldsetId)) {
			@defining(results.getFieldset(fieldsetId)) { _fieldset =>
				@if(_fieldset != null) {
					@fieldsets.fieldset(_fieldset)
				}
			}
		}
	}
}

@FIELD(field: Field, isLogged: Boolean, _options: Seq[(String,String)]) = {
	@defining(results.getField(field("field.id").value.getOrElse(""))) { _field =>
		@if(_field != null) {
			@views.html.fields.field(field, _field, isLogged, _options)
		}
	}
}